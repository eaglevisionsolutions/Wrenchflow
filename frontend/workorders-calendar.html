<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Work Orders Calendar - WrenchFlow</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/main.css">
  <style>
    .calendar-item { background: #388e3c; color: #fff; margin: 2px 0; padding: 2px 4px; border-radius: 3px; cursor: pointer; font-size: 0.9em; }
    .date-num { font-weight: bold; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <a class="navbar-brand" href="index.html">WrenchFlow</a>
    <div class="ms-auto">
      <a href="profile.html" class="btn btn-outline-light">Profile</a>
    </div>
  </nav>
  <div class="container mt-4">
    <h1>Work Orders Calendar</h1>
    <div id="calendar"></div>
    <div id="details" class="mt-3"></div>
  </div>
  <script src="js/api-service.js"></script>
  <script src="js/calendar-view.js"></script>
  <script src="js/sync-manager.js"></script>
  <script>
    import { renderStatusBar } from './js/ui-components.js';
    window.isOnline = isOnline;
    window.getSyncQueue = () => JSON.parse(localStorage.getItem('wrenchflow_sync_queue')||'[]');
    renderStatusBar();
    const shop_id = '11111111-1111-1111-1111-111111111111';
    const calendarDiv = document.getElementById('calendar');
    const detailsDiv = document.getElementById('details');
    function loadCalendar() {
      WrenchFlowAPI.getWorkOrders(shop_id)
        .then(data => {
          const items = data.map(w => ({
            id: w.work_order_id,
            date: w.date_created.split('T')[0],
            title: w.status + ' - ' + (w.reported_problem || '')
          }));
          renderCalendar(calendarDiv, items, {
            dateKey: 'date',
            titleKey: 'title',
            onClick: id => showDetails(id, data)
          });
        });
    }
    function showDetails(id, data) {
      const wo = data.find(w => w.work_order_id === id);
      if (!wo) return;
      detailsDiv.innerHTML = `<div class='card'><div class='card-body'><h5>Work Order Details</h5><p><b>Date:</b> ${wo.date_created}</p><p><b>Status:</b> ${wo.status}</p><p><b>Problem:</b> ${wo.reported_problem}</p><p><b>Diagnosis:</b> ${wo.diagnosis}</p><p><b>Repair Notes:</b> ${wo.repair_notes}</p></div></div>`;
    }
    loadCalendar();
  </script>
</body>
</html>
